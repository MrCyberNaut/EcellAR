<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MindAR.js Image Tracking Example</title>
    <!-- Include Three.js (MindAR.js uses Three.js under the hood) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
    <!-- Include MindAR.js (production build) -->
    <script src="https://unpkg.com/mind-ar@1.1.4/dist/mindar-image-three.prod.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #mindar-container {
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <!-- Container for the AR view -->
    <div id="mindar-container"></div>
    <script type="module">
      // Import MindAR namespace (if using module system, otherwise use global "MINDAR")
      // Create the MindAR three.js setup:
      const mindarThree = new window.MINDAR.IMAGE.MindARThree({
        container: document.querySelector("#mindar-container"),
        imageTargetSrc: "./assets/targets.mind", // Your generated MindAR target file
      });
      const { renderer, scene, camera } = mindarThree;

      // Create a textured plane that will appear on the target:
      const geometry = new THREE.PlaneGeometry(1.5, 2); // adjust dimensions as needed
      const texture = new THREE.TextureLoader().load("./assets/display-image.png"); // Replace with your display image URL/path
      const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
      const plane = new THREE.Mesh(geometry, material);
      // Optionally adjust plane position (e.g., lift it slightly above the marker)
      plane.position.set(0, 0.5, 0);

      // Add an anchor for the target (assuming your target index is 0)
      const anchor = mindarThree.addAnchor(0);
      anchor.group.add(plane);

      // Start the AR experience
      (async () => {
        await mindarThree.start();
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera);
        });
      })();

      // For debugging: log when the target is found/lost
      anchor.onTargetFound = () => {
        console.log("Target detected");
      };
      anchor.onTargetLost = () => {
        console.log("Target lost");
      };
    </script>
  </body>
</html>
